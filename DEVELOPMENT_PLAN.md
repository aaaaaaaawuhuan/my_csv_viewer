# CSV Viewer 开发计划

## 项目概述

开发一个基于 Qt 的 CSV 文件查看器，能够处理 100MB 级别的大文件，提供高效的浏览和筛选功能。

## 功能需求

1. 初始化时读取文件表头，生成侧边栏筛选面板
2. 记录文件总行数
3. 读取部分行并进行编码转换（如需）和解析显示
4. 用户勾选要筛选的列，点击筛选后显示已读取部分的筛选列
5. 显示竖向进度条（当前位置/文件最大行）
6. 用户拖动竖向进度条，实时读取文件、转换编码（如需）、解析、显示

## 开发步骤

### 阶段一：基础文件处理和初始化

#### 任务 1：实现 CSV 文件初始化读取
- [ ] 创建 CsvReader 类用于处理 CSV 文件
- [ ] 实现文件表头读取功能
- [ ] 实现文件总行数计算功能
- [ ] 创建初始化数据结构体（包含表头、总行数等信息）
- [ ] 实现基础的 CSV 解析功能（逗号分隔）
- [ ] **优化项：创建行映射表，记录每行在文件中的位置偏移量**

#### 任务 2：实现编码检测和转换
- [ ] 添加编码检测功能
- [ ] 实现常见编码（UTF-8, GBK, ASCII等）的转换
- [ ] 集成编码转换到文件读取流程中

### 阶段二：UI 设计和基础显示

#### 任务 3：设计主界面布局
- [ ] 创建主窗口框架
- [ ] 添加表格视图用于显示 CSV 数据
- [ ] 添加侧边栏用于筛选控制
- [ ] 添加垂直进度条
- [ ] 设计状态栏显示基本信息

#### 任务 4：实现基础数据显示
- [ ] 实现数据模型（QAbstractTableModel 或类似）
- [ ] 实现分页加载机制（只加载当前显示需要的数据）
- [ ] 连接 CsvReader 和数据模型
- [ ] 实现基本的表格显示功能

### 阶段三：筛选功能实现

#### 任务 5：实现筛选面板
- [ ] 在侧边栏动态生成筛选控件（基于表头）
- [ ] 实现筛选条件选择功能
- [ ] 添加"应用筛选"按钮

#### 任务 6：实现筛选逻辑
- [ ] 实现按列筛选功能
- [ ] 更新显示模型以只显示筛选结果
- [ ] 优化筛选性能

### 阶段四：进度控制和大文件浏览

#### 任务 7：实现垂直进度条
- [ ] 添加垂直滚动条控件
- [ ] 实现位置指示功能（当前位置/总行数）
- [ ] 添加位置标签显示

#### 任务 8：实现动态文件读取
- [ ] 实现根据进度条位置动态读取文件片段
- [ ] 集成编码转换到动态读取流程
- [ ] 实现数据实时更新显示
- [ ] **使用行映射表优化文件读取性能**

### 阶段五：优化和完善

#### 任务 9：性能优化
- [ ] 优化大文件读取性能
- [ ] 优化内存使用
- [ ] 实现文件缓存机制

#### 任务 10：用户体验优化
- [ ] 添加加载提示
- [ ] 优化界面交互
- [ ] 添加错误处理和提示

#### 任务 11：测试和完善
- [ ] 进行功能测试
- [ ] 进行大文件性能测试
- [ ] 修复发现的问题

## 技术要点

1. 使用 Qt 框架实现跨平台支持
2. 采用 C++17 标准编写
3. 实现高效的文件读取和内存管理策略
4. 实现编码检测和转换功能
5. 使用 Qt 的模型/视图架构
6. 实现异步加载以保持界面响应性
7. **实现行映射表优化随机访问性能**

## 预期成果

一个能够高效处理大体积 CSV 文件的查看器，具有友好的用户界面和流畅的浏览体验，支持筛选和编码转换功能。